<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>All Publications - Peters Lab</title>
</head>

<body>
    <!-- Navigation Bar --> 
<nav class="navbar">
    <div class="nav-left">
        <span class="logo">Peters Molecular Arbovirology Laboratory</span>
    </div>

    <!-- Hamburger button -->
    <button class="menu-toggle" id="menuToggle">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Dropdown menu -->
    <ul class="nav-links" id="navLinks">
        <li><a href="index.html" class="nav-item">Home</a></li>
        <li><a href="index.html#about" class="nav-item">About</a></li>
        <li><a href="team.html" class="nav-item">People</a></li>
        <li><a href="publications.html" class="nav-item">Publications</a></li>
        <li><a href="index.html#contact" class="nav-item">Contact</a></li>
    </ul>
</nav>

<!-- Publications Section -->
<section class="publications_section" id="publications">
    <div class="section_container">
        <h2 class="section_title" style="text-align: center; color: var(--primary);">All Publications</h2>
        <p style="text-align: center; margin-bottom: 30px; color: var(--text);">Complete collection of our research publications</p>
        
        <!-- Search Bar -->
        <div class="publications_search">
            <input 
                type="text" 
                id="pubSearch" 
                class="search_input" 
                placeholder="Search by title, author, or year..."
            >
        </div>

        <!-- Publications by Year -->
        <div id="publications-by-year" class="publications_by_year"></div>

        <script>
        let allPublications = [];

        fetch('references.json')
            .then(response => response.json())
            .then(entries => {
                allPublications = entries.sort((a, b) => (b.year || 0) - (a.year || 0));
                renderPublicationsByYear(allPublications);
                
                // Setup search functionality
                const searchInput = document.getElementById('pubSearch');
                searchInput.addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase();
                    const filtered = allPublications.filter(entry => {
                        const title = (entry.title || '').toLowerCase();
                        const author = (entry.author || '').toLowerCase();
                        const year = (entry.year || '').toLowerCase();
                        return title.includes(query) || author.includes(query) || year.includes(query);
                    });
                    renderPublicationsByYear(filtered);
                });
            })
            .catch(error => {
                document.getElementById('publications-by-year').innerHTML = 
                    '<p style="color: var(--text);">Error loading publications. Please ensure references.json exists.</p>';
            });

        function renderPublicationsByYear(entries) {
            const container = document.getElementById('publications-by-year');
            
            if (entries.length === 0) {
                container.innerHTML = '<p style="color: var(--text); text-align: center;">No publications found.</p>';
                return;
            }

            // Group publications by year
            const grouped = {};
            entries.forEach(entry => {
                const year = entry.year || 'N/A';
                if (!grouped[year]) {
                    grouped[year] = [];
                }
                grouped[year].push(entry);
            });

            // Create HTML for each year dropdown
            const years = Object.keys(grouped).sort((a, b) => b - a);
            container.innerHTML = years.map((year, index) => {
                const publications = grouped[year];
                return `
                    <div class="year-section">
                        <button class="year-dropdown" onclick="toggleYear(this)">
                            <span class="year-title">${year}</span>
                            <span class="year-count">(${publications.length})</span>
                            <span class="year-toggle">▼</span>
                        </button>
                        <div class="year-content" style="display: ${index === 0 ? 'block' : 'none'};">
                            <div class="publications-grid">
                                ${publications.map(entry => `
                                    <div class="publication_card">
                                        <div class="pub_year">${entry.year || 'N/A'}</div>
                                        <div class="pub_title">${entry.title || 'Untitled'}</div>
                                        <div class="pub_authors">${entry.author || 'Unknown'}</div>
                                        <div class="pub_journal">
                                            ${entry.journal || ''}${entry.journal && entry.volume ? ', ' : ''}${entry.volume || ''}
                                            ${entry.pages ? ` pp. ${entry.pages}` : ''}
                                        </div>
                                        ${entry.doi ? `<div class="pub_doi"><a href="https://doi.org/${entry.doi}" target="_blank">DOI: ${entry.doi}</a></div>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleYear(button) {
            const content = button.nextElementSibling;
            const toggle = button.querySelector('.year-toggle');
            const isVisible = content.style.display === 'block';
            
            content.style.display = isVisible ? 'none' : 'block';
            toggle.style.transform = isVisible ? 'rotate(0deg)' : 'rotate(180deg)';
        }
    </script>
    </div>
</section>

<!-- Footer -->
<footer class="footer">
    <div class="footer_container">
        <!-- Left side: Name -->
        <div class="footer_section footer_brand">
            <h3 class="footer_title">Peters | Molecular Arbovirology Laboratory</h3>
        </div>
        <!-- Middle: Quick Links -->
        <div class="footer_section">
            <h4>Quick Links</h4>
            <ul class="footer_links">
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#about">About</a></li>
                <li><a href="index.html#people">People</a></li>
                <li><a href="index.html#publications">Featured Publications</a></li>
                <li><a href="publications.html">All Publications</a></li>
                <li><a href="index.html#contact">Contact</a></li>
            </ul>
        </div>
        <!-- Right: Contact -->
        <div class="footer_section">
            <h4>Contact</h4>
            <div class="footer_socials">
                <a href="mailto:peterslabwebsite@gmail.com" class="social_icon">Email</a>
                <!-- Add more contact/social links as needed -->
            </div>
        </div>
    </div>
    <!-- Bottom Bar -->
    <div class="footer_bottom">
        © 2026 Hobson-Peters Research Lab. All Rights Reserved.
    </div>
</footer>

<script src="script.js"></script>
</body>
</html>
